*THIS PAGE IS UNDER CONSTRUCTION*

This document is based on the development version and should be considered as a technical specification document. As a consequence, some features could be absent from the last stable release and could be marked as _deprecated_ or _upcoming_ in the following documentation. See the [ChangeLog changelog] for details.

== Arguments ==

To run proxyshark, simply run the Python script _proxyshark.py_. You can use the following arguments:

==== `-h | --help` ====

 Print a help message describing the available command-line arguments.

==== `-v | --verbose [DEPRECATED]` ====

 Turn on verbose output. Can be specified twice for debugging mode.

 _Deprecated_: verbose output is now enabled by default, a log file _proxyshark.log_ is also created at startup. `[UPCOMING]`

==== `-q | --queue-num <queue-num>` ====

 Select a netfilter queue. Default is _0_.

==== `-t | --tshark-binary <tshark-binary>` ====

 Set the path to the tshark binary. Default is _bin/arch/tshark_ where _arch_ is the current architecture (_x86_64_, _armv7l_, etc). You can get your current architecture by running _uname -m_.

==== `-w | --web-ui [UPCOMING]` ====

 Enable the web-based interface. Default is command-line interface.

==== `-a | --bind-address <bind-address> [UPCOMING]` ====

 Set the bind address of the web server. Default is _127.0.0.1_.

==== `-p | --port <port> [UPCOMING]` ====

 Set the listening port of the web server. Default is _80_.

==== Examples ====

 Run proxyshark in command-line mode:

 {{{
python proxyshark.py
 }}}

 Run proxyshark on queue 123 in web-based mode and port 8080:

 {{{
python proxyshark.py -q 123 -w -p 8080
 }}}

== Command-line interface `[UPCOMING]` ==

The command-line interface allows the user to setup filters and to interactively manipulate the captured packets.

Several commands are available:

==== `h | help [command]` ====

 Print a help message describing the available commands. You can specify an optional command name to get information about a specific command.

==== `i | info` ====

 Print information about the current program state:
  * BPF filter and netfilter rules
  * breakpoints and actions
  * statistics

 See the [TechnicalDescription technical description] for details about BPF filters, netfilter rules, breakpoints and actions.

==== `b | breakpoint [filter-expression]` ====

 Create a new breakpoint based on the given expression. If no argument is given, print a list of the existing breakpoints. See the [TechnicalDescription technical description] for details about breakpoints.

==== `a | action <breakpoint-id> [python-code]` ====

 Create a new action associated with a breakpoint. The first argument must be a valid breakpoint identifier returned by the commands _b_ or _breakpoint_. The second argument is the Python code to be executed when the action is triggered. If no code is given, print the action associated with the breakpoint. See the [TechnicalDescription technical description] for details about actions and breakpoints.

==== `c | capture [bpf-filter]` ====

 Start a new capture. The argument will be parsed as a BPF filter and converted into a set of netfilter rules redirecting the matching packets to the selected netfilter queue. See the [TechnicalDescription technical description] for details about BPF filters and netfilter rules.

==== `en | enable <breakpoint-id>` ====

 Enable an existing breakpoint. The _breakpoint-id_ must be a valid breakpoint identifier returned by the commands _b_ or _breakpoint_.

==== `dis | disable <breakpoint-id>` ====

 Disable an existing breakpoint. The _breakpoint-id_ must be a valid breakpoint identifier returned by the commands _b_ or _breakpoint_. 

==== `d | delete <type> <id>` ====

 Delete a breakpoint or an action. The _type_ argument can be _b_ or _breakpoint_ for a breakpoint and _a_ or _action_ for an action. The _id_ must be a valid breakpoint or action identifier returned by the commands _b_, _breakpoint_, _a_ or _action_.

==== `pkts | packets` ====

 A special variable containing all the dissected packets.

==== `pkt | packet` ====

 A special variable containing the last dissected packet.

==== `accept` ====

 Accept the current packet and resume the capture.

==== `drop` ====

 Drop the current packet and resume the capture.

==== Examples ====

 Capture HTTP traffic from/to www.google.com and break on index requests:

 {{{
>>> b http.method == "GET" and http.uri == "/"
new breakpoint with id 1
>>> c host www.google.com and port 80
capturing...
on breakpoint 1: http.method == "GET" and http.uri == "/"
>>> 
 }}}

 Print the captured packet:

 {{{
>>> print pkt
0.000000 192.168.98.102 -> 74.125.39.104 HTTP GET / HTTP/1.1
 }}}

 Modify the URI and let the packet go:

 {{{
>>> pkt.uri = "/modified.php"
>>> accept
capturing...
 }}}

 Automatically modify the URI when an index request is encountered:

 {{{
>>> b http.method == "GET" and http.uri == "/"
new breakpoint with id 1
>>> a 1 http.uri = "/modified.php"; accept
new action on breakpoint 1
>>> c host www.google.com and port 80
capturing...
on breakpoint 1: running action
on breakpoint 1: running action
on breakpoint 1: running action
 }}}

 Get all the TCP packets:

 {{{
>>> pkts.tcp
[4 packets]
>>> 
 }}}

 Get the TCP packets where the SYN flag is set:

 {{{
>>> pkts.tcp(flags.syn == 1)
 }}}
 